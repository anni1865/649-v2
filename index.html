<!--649 Final Project--><!--test line-->
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.29.1"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <script src="http://d3js.org/colorbrewer.v1.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">
</head>
<body>
    <div id="filter">
        <div id = "scatterplot_overall" class="scatterplot_view_small"><h2>Overall View</h2>  
              <div id = "overall">
              <input class="filter_overall overall_0" id="0" type="radio" name="overall">All</input>
              <input class="filter_overall overall_20" id="20" type="radio" name="overall">20+ </input>
              <input class="filter_overall overall_50" id="50" type="radio" name="overall">50+ </input>
              <input class="filter_overall overall_100" id="100" type="radio" name="overall">100+ </input>
              </div>
        </div> 
        <div id = "scatterplot_likes"><h2>Likes View</h2>
              <div id = "likes">
              <input class="filter_likes likes_0" id="0" type="radio" name="likes">All</input>
              <input class="filter_likes likes_20" id="20" type="radio" name="likes">20+ </input>
              <input class="filter_likes likes_50" id="50" type="radio" name="likes">50+ </input>
              <input class="filter_likes likes_100" id="100" type="radio" name="likes">100+ </input>
              </div> 
        </div> 

        <div id = "scatterplot_hugs"><h2>Hugs View</h2> 
              <div id = "hugs">
                  <input class="filter_hugs hugs_0" id="0" type="radio" name="hugs">All</input>
                  <input class="filter_hugs hugs_20" id="20" type="radio" name="hugs">20+ </input>
                  <input class="filter_hugs hugs_50" id="50" type="radio" name="hugs">50+ </input>
                  <input class="filter_hugs hugs_100" id="100" type="radio" name="hugs">100+ </input>
              </div>
        </div>  
    		
        <div id = "scatterplot_metoos"><h2>Metoos View</h2> 
              <div id = "metoos">
                  <input class="filter_metoos metoos_0" id="0" type="radio" name="metoos">All</input>
                  <input class="filter_metoos metoos_20" id="20" type="radio" name="metoos">20+ </input>
                  <input class="filter_metoos metoos_50" id="50" type="radio" name="metoos">50+ </input>
                  <input class="filter_metoos metoos_100" id="100" type="radio"  name="metoos">100+ </input>
            </div>
        </div>
   </div>
   <div id = "scatterplot">
              <div id = "topic_data_size">
                  Sample Data Size (Range: 0-default:800 posts) 
                  <input class="input_data_size" type="text" name="likes"></input>
                  <button id="submit" name="submit"> Submit </button>
                  <button id="reset" name="reset"> Reset </button>
              </div>
              <div id="tooltip" class="hidden">
                <p><strong>Post <span id="post-id"></span></strong></p>
                <p><span id="post_value"></span></p>
                <p>Likes: <span id="post_likes"></span> Hugs: <span id="post_hugs"></span> Me toos: <span id="post_metoos"></span></p>
              </div>

   </div>        
<script>
// Add Filter
var overall_filter=0,likes_filter=0, hugs_filter=0, metoos_filter=0;
var data_size = 500;
var data_num = 0;

function drawTopics(data_size,data_num,likes_filter,hugs_filter,metoos_filter){
  drawTopicsView(data_size,data_num,"big","overall",likes_filter,hugs_filter,metoos_filter);
  drawTopicsView(data_size,data_num,"small","overall",likes_filter,hugs_filter,metoos_filter);
  drawTopicsView(data_size,data_num,"small","likes",likes_filter,hugs_filter,metoos_filter);
  drawTopicsView(data_size,data_num,"small","hugs",likes_filter,hugs_filter,metoos_filter);
  drawTopicsView(data_size,data_num,"small","metoos",likes_filter,hugs_filter,metoos_filter);
}

d3.selectAll(".sp_overall").on("click", function() {
  console.log("hello");
});


d3.selectAll(".filter_overall").on("change", function() {
          if(this.checked){
            overall_filter=this.id;
            console.log("id:"+overall_filter);
            d3.selectAll('.likes_'+overall_filter).attr('checked','true');
            d3.selectAll('.hugs_'+overall_filter).attr('checked','true');
            d3.selectAll('.metoos_'+overall_filter).attr('checked','true');
          }
          else {
            overall_filter=0;
          }
         d3.selectAll(".dot_big").remove();
         d3.selectAll(".g_big").remove();
         drawTopics(data_size,data_num,overall_filter,overall_filter,overall_filter);
   // drawKeywords();
});

d3.selectAll(".filter_likes").on("change", function() {
          if(this.checked){
            likes_filter=this.id;
          }
          else {
            likes_filter=0;
          }
          drawTopicsView(data_size,data_num,"small","likes",likes_filter,hugs_filter,metoos_filter);
   // drawKeywords();
 });

d3.selectAll(".filter_hugs").on("change", function() {
          if(this.checked){
            hugs_filter=this.id;
          }
          else {
            hugs_filter=0;
          }
          drawTopicsView(data_size,data_num,"small","hugs",likes_filter,hugs_filter,metoos_filter);
   // drawKeywords();
 });

d3.selectAll(".filter_metoos").on("change", function() {
          if(this.checked){
            metoos_filter=this.id;
          }
          else {
            metoos_filter=0;
          }
          drawTopicsView(data_size,data_num,"small","metoos",likes_filter,hugs_filter,metoos_filter);
 });
//Add Text

//draw xy axis
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 1050 - margin.left,
    height = 450 - margin.top;
    margin_small = 6,
    width_small=150-margin_small,
    height_small=150-margin_small;

var x = d3.scale.linear()
    .range([50, width]);

var y = d3.scale.linear()
    .range([height, 20]);

var x_small = d3.scale.linear()
    .range([6, width_small]);

var y_small = d3.scale.linear()
.range([width_small, 6]);

var xAxis = d3.svg.axis()
    .scale(x)
    .ticks(10).tickSubdivide(10)
    .orient("bottom");

var yAxis = d3.svg.axis()
    .scale(y)
    .ticks(5).tickSubdivide(5)
    .orient("left");

var xAxis_small = d3.svg.axis()
    .scale(x_small)
    .ticks(0)
    .tickSize(0)
    .orient("bottom");

var yAxis_small = d3.svg.axis()
    .scale(y_small)
    .ticks(0)
    .tickSize(0)
    .orient("left");

var svg_overall = d3.select("#scatterplot_overall").append("svg")
        .attr("class", "sp_overall")
        .append("g");

var svg_likes= d3.select("#scatterplot_likes").append("svg")
        .attr("class", "sp_likes")
        .append("g");

var svg_hugs = d3.select("#scatterplot_hugs").append("svg")
        .attr("class", "sp_hugs")
        .append("g");

var svg_metoos = d3.select("#scatterplot_metoos").append("svg")
        .attr("class", "sp_metoos")
        .append("g");

var svg = d3.select("#scatterplot").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("class", "sp_bigview")
      	.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        x.domain([-1,1]);
        y.domain([0,1]);
        x_small.domain([-1,1]);
        y_small.domain([0,1]);

/*Draw overall view scatterplot*/
    svg_overall.append("g")
        .attr("class", "x_small axis grid")
        .attr("transform", "translate(0," + height_small/2 + ")")
        .call(xAxis_small);

    svg_overall.append("g")
        .attr("class", "y_small axis grid")
        .attr("transform", "translate(" + width_small/2 + ",0)")
        .call(yAxis_small);

/*Draw likes view scatterplot*/
     svg_likes.append("g")
        .attr("class", "x_small axis grid")
        .attr("transform", "translate(0," + height_small/2 + ")")
        .call(xAxis_small);

    svg_likes.append("g")
        .attr("class", "y_small axis grid")
        .attr("transform", "translate(" + width_small/2 + ",0)")
        .call(yAxis_small);

/*Draw hugs view scatterplot*/
     svg_hugs.append("g")
        .attr("class", "x_small axis grid")
        .attr("transform", "translate(0," + height_small/2 + ")")
        .call(xAxis_small);

    svg_hugs.append("g")
        .attr("class", "y_small axis grid")
       .attr("transform", "translate(" + width_small/2 + ",0)")
        .call(yAxis_small);

/*Draw metoos view scatterplot*/
     svg_metoos.append("g")
        .attr("class", "x_small axis grid")
       .attr("transform", "translate(0," + height_small/2 + ")")
        .call(xAxis_small);

    svg_metoos.append("g")
        .attr("class", "y axis grid")
        .attr("transform", "translate(" + width_small/2 + ",0)")
        .call(yAxis_small);

/*Draw big view scatterplot*/
     svg.append("g")
        .attr("class", "x axis grid")
        .attr("transform", "translate(0," + height/2 + ")")
        .call(xAxis)
        .append("text")
        .attr("class", "label-positive")
        .attr("x", width)
        .attr("y", -6)
        .style("text-anchor", "end")
        .text("sentiment");

    var w=width/2+20;
    svg.append("g")
        .attr("class", "y axis grid")
        .attr("transform", "translate(" + w + ",0)")
        .call(yAxis)
        .append("text")
        .attr("class", "label-polarrity")
        .attr("x", 50)
        // .attr("transform", "rotate(-90)")
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("polarity");

drawTopics(data_size,data_num,likes_filter,hugs_filter,metoos_filter);

// var Topic_frequency = [18663,15115,11457,18862,21771,26240,23141,23794,30837,31849];

function color(i){
    var color = d3.scale.ordinal()
                .domain([0,1,2,3,4,5,6,7,8,9])
                .range(["rgb(31, 119, 180)","rgb(174, 199, 232)","rgb(255, 127, 14)","rgb(255, 187, 120)","rgb(44, 160, 44)","rgb(152, 223, 138)","rgb(214, 39, 40)","rgb(153,153,153)","rgb(153,153,153)","rgb(153,153,153)"]);
    return color(i);
}

function drawTopicsView(data_size,data_num,view,map,likes_filter,hugs_filter,metoos_filter){
  d3.csv("data/all_topic"+data_num+".csv")
      .row(function(d) { return {  ID: d.ID, 
                                   PostID: d.PostID, 
                                   text: d.Text,
                                   URL:d.URL, 
                                   Likes:+d.Likes,
                                   Hugs:+d.Hugs,
                                   MeToos:+d.Metoos,
                                   sentiment: +d.sentiment,
                                   sentiment_tag: d.sentiment_tag,
                                   polarity: +d.polarity,
                                   polarity_tag: +d.polarity_tag,
                                   concept_text: d.concept_text, //changed to TopicNum in the new data file
                                   concept_type: d.concept_type}; //changed to TopicText in the new data file
      })
      .get(function(error, rows) { 
        if(data_size>rows.length){
          data_size=rows.length;
        }
         d3.selectAll(".dot_small_"+map).remove();
         d3.selectAll(".g_small_"+map).remove();

            for(var i=0; i<data_size;i++){
                 if((rows[i].polarity>=0)&&(rows[i].polarity<=1)&&(rows[i].sentiment>=-1)&&(rows[i].sentiment<=1)){
                         if (view=="small") {
                               if (map=="overall") {
                                    if(rows[i].Likes>=likes_filter || rows[i].Hugs>=hugs_filter || rows[i].MeToos>=metoos_filter ){
                                    draw_small_plot(rows[i],map,data_num);
                                    }
                                }
                                if (map=="likes") {
                                 
                                   if(rows[i].Likes>=likes_filter){
                                   draw_small_plot(rows[i],map,data_num);}
                                }
                                if (map=="hugs") {
                               
                                   if(rows[i].Hugs>=hugs_filter){
                                   draw_small_plot(rows[i],map,data_num);}
                                }
                                if (map=="metoos") {
                                 
                                   if(rows[i].MeToos>=metoos_filter){
                                   draw_small_plot(rows[i],map,data_num);}
                                }
                         }
                         else{
                          if(rows[i].Likes>=likes_filter || rows[i].Hugs>=hugs_filter || rows[i].MeToos>=metoos_filter )
                            {
                              draw_big_plot(rows[i],data_num);
                            }
                         }
                  }
             }

      });
}


function draw_big_plot(data,data_num){
   d3.select(".sp_bigview")
      .append("g")
      .attr("class", "g_big")
      .append("circle")
      .attr("class", "dot_big")
      .attr("transform", "translate(80,20)")
      .attr("r",5)
      .attr("cx", x(data.sentiment))
      .attr("cy", y(data.polarity))
      .style("fill", "#999")
      .style("stroke","#fff")
      .on("mouseover", function(){
              d3.select(this).transition()
                .duration(500)
                .style("fill", "#999")
                .attr("opacity", 1);
                var xPosition=parseFloat(d3.select(this).attr("cx"))+126;
                var yPosition=parseFloat(d3.select(this).attr("cy"))-20;
                d3.select("#tooltip")
                    .style("left",xPosition+"px")
                    .style("top",yPosition+"px")
                    .select("#post-id")
                    .text("#"+data.PostID);
               d3.select("#tooltip").select("#post_value")
                    .text(data.text);
               d3.select("#tooltip").select("#post_likes")
                    .text(data.Likes);
               d3.select("#tooltip").select("#post_hugs")
                    .text(data.Hugs);
                d3.select("#tooltip").select("#post_metoos")
                    .text(data.MeToos +" sentiment:"+ data.sentiment + " polarity:" +data.polarity);

                d3.select("#tooltip").style("visibility","visible");
      })
      .on("mouseout", function(){
            d3.select("#tooltip").style("visibility","hidden");
            d3.select(this).transition()
              .attr("opacity", 1)
              .transition()
              .style("fill", color(data_num))
              .attr("opacity", 0.5)
      })
      .transition().duration(5000)
      .style("fill", color(data_num))
      .attr("r",20)
      .style("opacity",0.5)
      .ease("bounce");
}

function draw_small_plot(data,map,data_num){
   d3.select(".sp_"+map)
      .append("g")
      .attr("class", "g_small_"+map)
      .append("circle")
      .attr("class", "dot_small_"+map)
      .attr("r",2)
      .style("fill", "#999")
      .attr("cx", x_small(data.sentiment))
      .attr("cy", y_small(data.polarity))
      .style("stroke","#f2f2f2")
      .transition().duration(5000)
      .attr("r",5)
      .style("fill", color(data_num))
      .style("opacity",0.5)
      .ease("cubic-out");
}


</script>


</body>
</html>