<!--649 Final Project--><!--test line-->
<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no"/>
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js?1.29.1"></script>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/colorbrewer.v1.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="index.css">
</head>
<body>
    <div id="filter">
        <div id = "scatterplot_overall"><h2>Overall View</h2>  <div id = "overall">
              <input class="filter_overall" id="20" type="radio" name="likes">20+ </input>
              <input class="filter_overall" id="50" type="radio" name="likes">50+ </input>
              <input class="filter_overall" id="100" type="radio" name="likes">100+ </input>
        </div></div> 
        <div id = "scatterplot_likes"><h2>Likes View</h2>
              <div id = "likes">
              <input class="filter_likes" id="20" type="radio" name="likes">20+ </input>
              <input class="filter_likes" id="50" type="radio" name="likes">50+ </input>
              <input class="filter_likes" id="100" type="radio" name="likes">100+ </input>
              </div> 
        </div> 

        <div id = "scatterplot_hugs"><h2>Hugs View</h2> 
              <div id = "hugs">
                  <input class="filter_hugs" id="20" type="radio" name="hugs">20+ </input>
                  <input class="filter_hugs" id="50" type="radio" name="hugs">50+ </input>
                  <input class="filter_hugs" id="100" type="radio" name="hugs">100+ </input>
              </div>
        </div>  
    		
        <div id = "scatterplot_metoos"><h2>Metoos View</h2> 
              <div id = "metoos">
                  <input class="filter_metoos" id="20" type="radio" name="metoos">20+ </input>
                  <input class="filter_metoos" id="50" type="radio" name="metoos">50+ </input>
                  <input class="filter_metoos" id="100" type="radio"  name="metoos">100+ </input>
            </div>
        </div>
  
   </div>
      <div id="slider" width="100%"></div>
      <div id = "scatterplot"></div>        

<script type="text/javascript">
$("#slider").slider(
{
            value:100,
            min: 0,
            max: 500,
            step: 50,
            slide: function( event, ui ) {
                $( "#slider-value" ).html( ui.value );
            }
}
);

</script>
<script>
// Add Filter
var overall_filter=0,likes_filter=0, hugs_filter=0, metoos_filter=0;
drawTopics(0);
d3.selectAll(".filter_overall").on("change", function() {
  var type = this.value;
    if(this.class="filter_overall"){
          if(this.checked){
            overall_filter=this.id;
          }
          else {
            overall_filter=0;
          }
          drawTopicsView(0,"small","overall",likes_filter,hugs_filter,metoos_filter);
    }
   // drawKeywords();
 });
d3.selectAll(".filter_likes").on("change", function() {
  var type = this.value;
    if(this.class="filter_likes"){
          if(this.checked){
            likes_filter=this.id;
          }
          else {
            likes_filter=0;
          }
          drawTopicsView(0,"small","likes",likes_filter,hugs_filter,metoos_filter);
    }
   // drawKeywords();
 });
d3.selectAll(".filter_hugs").on("change", function() {
  var type = this.value;
    if(this.class="filter_hugs"){
          if(this.checked){
            hugs_filter=this.id;
          }
          else {
            hugs_filter=0;
          }
          drawTopicsView(0,"small","hugs",likes_filter,hugs_filter,metoos_filter);
    }
   drawKeywords();
 });
d3.selectAll(".filter_metoos").on("change", function() {
  var type = this.value;
    if(this.class="filter_metoos"){
          if(this.checked){
            metoos_filter=this.id;
          }
          else {
            metoos_filter=0;
          }
          drawTopicsView(0,"small","metoos",likes_filter,hugs_filter,metoos_filter);
    }
   drawKeywords();
 });
//Add Text

//draw xy axis
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 1000 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom
    margin_small = 6,
    width_small=150-margin_small,
    height_small=150-margin_small;

var x = d3.scale.linear()
    .range([40, width]);

var y = d3.scale.linear()
    .range([height, 10]);

var x_small = d3.scale.linear()
    .range([6, width_small]);

var y_small = d3.scale.linear()
.range([width_small, 6]);

function color(i){
    var color = d3.scale.ordinal()
                .domain([0,1,2,3,4,5,6,7,8,9])
                .range(["rgb(31, 119, 180)","rgb(174, 199, 232)","rgb(255, 127, 14)","rgb(255, 187, 120)","rgb(44, 160, 44)","rgb(152, 223, 138)","rgb(214, 39, 40)","rgb(153,153,153)","rgb(153,153,153)","rgb(153,153,153)"]);
    return color(i);
}

var yAxis = d3.svg.axis()
    .scale(y)
    .ticks(5).tickSubdivide(5)
    .orient("left");

var xAxis = d3.svg.axis()
    .scale(x)
    .ticks(10).tickSubdivide(10)
    .orient("bottom");

var yAxis_small = d3.svg.axis()
    .scale(y_small)
    .ticks(0)
    .orient("left");

var xAxis_small = d3.svg.axis()
    .scale(x_small)
    .ticks(0)
    .orient("bottom");

var svg_overall = d3.select("#scatterplot_overall").append("svg")
        .attr("class", "sp_overall")
        .append("g");

var svg_likes= d3.select("#scatterplot_likes").append("svg")
        .attr("class", "sp_likes")
        .append("g");

var svg_hugs = d3.select("#scatterplot_hugs").append("svg")
        .attr("class", "sp_hugs")
        .append("g");

var svg_metoos = d3.select("#scatterplot_metoos").append("svg")
        .attr("class", "sp_metoos")
        .append("g");

var svg = d3.select("#scatterplot").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .attr("class", "sp_bigview")
      	.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

d3.csv("data/sentimentallistoutput1202.csv", function(error, data) {
      data.forEach(function(d) {
        d.sentiment = +d.sentiment;
        d.polarity = +d.polarity;
      });

x.domain(d3.extent(data, function(d) { return d.sentiment; }));
y.domain(d3.extent(data, function(d) { return d.polarity; }));
x_small.domain(d3.extent(data, function(d) { return d.sentiment; }));
y_small.domain(d3.extent(data, function(d) { return d.polarity; }));

/*Draw overall view scatterplot*/
    svg_overall.append("g")
        .attr("class", "x_small axis grid")
        .attr("transform", "translate(0," + height_small/2 + ")")
        .call(xAxis_small);

    svg_overall.append("g")
        .attr("class", "y_small axis grid")
        .attr("transform", "translate(" + width_small/2 + ",0)")
        .call(yAxis_small);

/*Draw likes view scatterplot*/
     svg_likes.append("g")
        .attr("class", "x_small axis grid")
        .attr("transform", "translate(0," + height_small/2 + ")")
        .call(xAxis_small);

    svg_likes.append("g")
        .attr("class", "y_small axis grid")
        .attr("transform", "translate(" + width_small/2 + ",0)")
        .call(yAxis_small);

/*Draw hugs view scatterplot*/
     svg_hugs.append("g")
        .attr("class", "x_small axis grid")
        .attr("transform", "translate(0," + height_small/2 + ")")
        .call(xAxis_small);

    svg_hugs.append("g")
        .attr("class", "y_small axis grid")
       .attr("transform", "translate(" + width_small/2 + ",0)")
        .call(yAxis_small);

/*Draw metoos view scatterplot*/
     svg_metoos.append("g")
        .attr("class", "x_small axis grid")
       .attr("transform", "translate(0," + height_small/2 + ")")
        .call(xAxis_small);

    svg_metoos.append("g")
        .attr("class", "y axis grid")
        .attr("transform", "translate(" + width_small/2 + ",0)")
        .call(yAxis_small);

/*Draw big view scatterplot*/
     svg.append("g")
        .attr("class", "x axis grid")
        .attr("transform", "translate(0," + height/2 + ")")
        .call(xAxis)
        .append("text")
        .attr("class", "label-positive")
        .attr("x", width)
        .attr("y", -6)
        .style("text-anchor", "end")
        .text("sentiment");

    var w=width/2+20;
    svg.append("g")
        .attr("class", "y axis grid")
        .attr("transform", "translate(" + w + ",0)")
        .call(yAxis)
        .append("text")
        .attr("class", "label-polarrity")
        .attr("x", 50)
        // .attr("transform", "rotate(-90)")
        .attr("dy", ".71em")
        .style("text-anchor", "end")
        .text("polarity");

    });

// var Topic_frequency = [18663,15115,11457,18862,21771,26240,23141,23794,30837,31849];


function drawTopics(data_num){
  drawTopicsView(data_num,"big","overall",likes_filter,hugs_filter,metoos_filter);
  drawTopicsView(data_num,"small","overall",likes_filter,hugs_filter,metoos_filter);
  drawTopicsView(data_num,"small","likes",likes_filter,hugs_filter,metoos_filter);
  drawTopicsView(data_num,"small","hugs",likes_filter,hugs_filter,metoos_filter);
  drawTopicsView(data_num,"small","metoos",likes_filter,hugs_filter,metoos_filter);
}


function drawTopicsView(data_num,view,map,likes_filter,hugs_filter,metoos_filter){

  d3.csv("data/all_topic"+data_num+".csv")
      .row(function(d) { return {  ID: d.ID, 
                                   PostID: d.PostID, 
                                   text: d.Text,
                                   URL:d.URL, 
                                   Likes:+d.Likes,
                                   Hugs:+d.Hugs,
                                   MeToos:+d.Metoos,
                                   sentiment: +d.sentiment,
                                   sentiment_tag: d.sentiment_tag,
                                   polarity: +d.polarity,
                                   polarity_tag: +d.polarity_tag,
                                   concept_text: d.concept_text, //changed to TopicNum in the new data file
                                   concept_type: d.concept_type}; //changed to TopicText in the new data file
      })
      .get(function(error, rows) { 
         d3.selectAll(".dot_small_"+map).remove();
            d3.selectAll(".text_small_"+map).remove();
            for(var i=0; i<3000;i++){
                 if((rows[i].polarity>=0)&&(rows[i].polarity<=1)&&(rows[i].sentiment>=-1)&&(rows[i].sentiment<=1)){
                         if (view=="small") {
                               if (map=="overall") {
                                    if((rows[i].Likes>=overall_filter)&&(rows[i].Hugs>=overall_filter)&&(rows[i].MeToos>=overall_filter)){
                                    draw_small_plot(rows[i],map,data_num);}
                                }
                                if (map=="likes") {
                                 
                                   if(rows[i].Likes>=likes_filter){
                                   draw_small_plot(rows[i],map,data_num);}
                                }
                                if (map=="hugs") {
                               
                                   if(rows[i].Hugs>=hugs_filter){
                                   draw_small_plot(rows[i],map,data_num);}
                                }
                                if (map=="metoos") {
                                 
                                   if(rows[i].MeToos>=metoos_filter){
                                   draw_small_plot(rows[i],map,data_num);}
                                }
                         }
                         else{
                              draw_big_plot(rows[i],data_num);
                         }
                  }
             }

      });
}

function draw_big_plot(data,data_num){
   d3.select(".sp_bigview")
      .append("g")
      .append("circle")
      .attr("class", "dot_big")
      .attr("r",5)
      .attr("cx", x(data.sentiment))
      .attr("cy", y(data.polarity))
      .style("fill", color(data_num))
      .style("stroke","#999999")
      .style("opacity",0.8);
}

function draw_small_plot(data,map,data_num){
   d3.select(".sp_"+map)
      .append("g")
      .append("circle")
      .attr("class", "dot_small_"+map)
      .attr("r",5)
      .attr("cx", x_small(data.sentiment))
      .attr("cy", y_small(data.polarity))
      .style("fill", color(data_num))
      .style("stroke","#999999")
      .style("opacity",0.8);
}

</script>


</body>
</html>